# GitHub Copilot Instructions for RimWorld Modding Project

## Mod Overview and Purpose

This mod aims to enhance the diversity of pawn kinds within RimWorld by providing a system to skew faction and pawn kind generation probabilities. Specifically, it allows players to alter the distribution of pawn races and factions, ensuring a richer and more varied in-game experience. Players can customize these settings through in-game menus and save their preferences for different worlds.

## Key Features and Systems

- **Race Diversification**: Alter the probability of race appearance using settings managed through the `RaceDiversificationPool` and `ModSettingsHandler`.
- **Dynamic Faction Weighting**: Customize faction appearances during world generation with `FactionWeight`.
- **Pawn Kind Adjustments**: Define weights for different pawn kinds using `PawnkindWeight`, ensuring that players encounter a wide array of characters.
- **Exclusion Mechanism**: Use `RaceRandomizationExcluded` to mark races that should be excluded from randomization.
- **User Interface Integration**: The Windows, such as `FactionExclusionWindow` and `WeightSettingsWindow`, allow users to configure their preferences via intuitive interfaces.
- **World-Specific Settings**: Store and manage settings specific to game worlds with `ModSettingsWorldStorage` and `ModWorldSettingsHandler`.

## Coding Patterns and Conventions

- **Class Sealing**: Many classes like `GeneralLoadingDatabase`, `ExtensionDatabase`, and `FactionWeight` are sealed to prevent inheritance, ensuring that the architecture remains robust and predictable.
- **Access Modifiers**: Follow consistent use of access modifiers, primarily keeping methods private unless needed externally, to enhance encapsulation.
- **Separation of Concerns**: Systems are divided logically into classes, each handling specific aspects like settings (`ModSettingsHandler`) or interface windows (`FactionExclusionWindow`).

## XML Integration

- **XML DefExtensions**: The mod uses DefModExtension classes, such as `RaceDiversificationPool`, to extend existing RimWorld definitions with custom functionality, enabling the mod to integrate seamlessly with the XML-based mod loading system of RimWorld.
- **XML Configuration**: Ensure that XML files are correctly formatted and referenced within the code. Proper XML handling can determine how race names and other parameters are parsed and utilized.

## Harmony Patching

- **Patch Purpose**: `HarmonyPatches` is utilized to alter existing game methods, allowing the mod to inject its logic where necessary. This is crucial for ensuring that the custom pawn and faction generation logic override the default behaviors.
- **Patch Execution**: Patches explore assemblies and dynamically apply changes to appropriate classes. Ensure these patches are robust and include error handling for unexpected game updates or configurations.

## Suggestions for Copilot

- **Consistent Naming Conventions**: Use clear and descriptive names for methods and variables. For instance, prefer `CalculateSpawnChances` over `CalcSpCh`.
- **Code Comments**: Encourage Copilot to generate comments, especially for complex logic or multistep processes, ensuring maintainability.
- **XML Helper Methods**: Implement helper methods to streamline XML processing and loading to avoid repetitive code blocks.
- **Test-Driven Development (TDD)**: Engage Copilot to suggest unit tests for critical functions, ensuring that changes are verifiable and stable.
- **Harmony Patch Conditions**: Incorporate safety checks in patches generated by Copilot to prevent breaking game updates or unexpected behavior.
